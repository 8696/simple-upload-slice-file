{"version":3,"sources":["webpack://SimpleUploadSliceFile/webpack/universalModuleDefinition","webpack://SimpleUploadSliceFile/webpack/bootstrap","webpack://SimpleUploadSliceFile/./src/tool.js","webpack://SimpleUploadSliceFile/./src/index.js","webpack://SimpleUploadSliceFile/./src/polyfill.js","webpack://SimpleUploadSliceFile/./src/upload.js","webpack://SimpleUploadSliceFile/./src/slice.js","webpack://SimpleUploadSliceFile/./src/http.js","webpack://SimpleUploadSliceFile/./src/queue.send.js","webpack://SimpleUploadSliceFile/./src/getMd5.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Tool","keys","maxPos","length","str","charAt","Math","floor","random","Date","getTime","fileName","split","pop","query","reg","obj","exec","RegExp","$1","$2","origin","target","prop","_typeof","toString","deepClone","_upload","UploadFile","assign","varArgs","TypeError","to","index","arguments","nextSource","nextKey","writable","configurable","options","_classCallCheck","this","chunkSile","url","formData","formSleceFile","headers","callBack","sliceTryFreq","isSendCheckMd5","delay","datas","files","file","Error","nodeType","jQuery","FileList","File","slice","Slice","totalSize","size","fileKey","makeRandom","slices","getSlice","primordial","_this","allField","progressCallObj","md5CallObj","allSuccessResult","_loop","singleFile","singleLoadedTotal","chunkLength","loadedTotalSize","field","md5","_getMd2","default","success","res","is","getFileMd5","md5Header","push","upload-file-id","suffix","getFileNameSuffix","Http","checkMd5Result","resp","isCheckMd5Request","upload-file-md5","JSON","stringify","send","progress","complete","error","upload-size-range","start","end","upload-total-size","upload-total-slice","upload-now-order","_progress","singleSuccess","response","parse","k","splice","allSuccess","e","sliceSuccess","console","log","tryFreqError","errorMsg","fileData","fieldName","order","_compute","ceil","blob","nowUploadKey","queueSend","queue","trySend","maxTrySend","cancelSend","httpStatus","lastHttpStatus","removeField","fn","FormData","xhr","XMLHttpRequest","test","open","append","setRequestHeader","onreadystatechange","readyState","status","sendSuccess","responseText","isSendLoading","upload","onprogress","evt","lengthComputable","loaded","setTimeout","filter","item","hex_chr","md5cycle","x","a","b","md5blk","md5blks","charCodeAt","md5blk_array","md51","tail","tmp","lo","hi","state","substring","match","parseInt","rhex","j","hex","join","toUtf8","unescape","encodeURIComponent","hexToBinaryString","bytes","substr","String","fromCharCode","apply","SparkMD5","reset","ArrayBuffer","clamp","val","max","min","from","num","targetArray","sourceArray","byteLength","begin","undefined","Uint8Array","set","appendBinary","contents","_buff","_length","_hash","raw","ret","buff","_finish","getState","hash","setState","destroy","hashBinary","content","arr","first","second","returnUInt8Array","result","buffer","subarray","utf8Str2ArrayBuffer","md51_array","md5Str","blobSlice","mozSlice","webkitSlice","chunkSize","chunks","currentChunk","spark","fileReader","FileReader","loadNext","readAsArrayBuffer","onload","md5_progress","msg","onerror"],"mappings":"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","file":"simple-upload-slice-file.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"SimpleUploadSliceFile\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"SimpleUploadSliceFile\"] = factory();\n\telse\n\t\troot[\"SimpleUploadSliceFile\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","\r\n\r\n\r\nclass Tool {\r\n    /**\r\n     * @description 生成随机字符串\r\n     * @return {String}\r\n     * */\r\n    static makeRandom() {\r\n        let keys = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n        let maxPos = keys.length;\r\n        let str = '';\r\n        for (let i = 0; i < 20; i++) {\r\n            str += keys.charAt(Math.floor(Math.random() * maxPos));\r\n        }\r\n        return str + new Date().getTime();\r\n\r\n    }\r\n\r\n    /**\r\n     * @description 获取文件名后缀\r\n     * @return {String} 文件名称\r\n     * @return {String}\r\n     * */\r\n    static getFileNameSuffix(fileName) {\r\n        return fileName.split('.').pop();\r\n    }\r\n    /**\r\n     * @description 将queryString解析成对象\r\n     * @return {String} queryString\r\n     * @return {Object} 转换之后的对象\r\n     * */\r\n    static queryStringToObj(query) {\r\n        let reg = /([^=&\\s]+)[=\\s]*([^&\\s]*)/g;\r\n        let obj = {};\r\n        while (reg.exec(query)) {\r\n            obj[RegExp.$1] = RegExp.$2;\r\n        }\r\n        return obj;\r\n    }\r\n\r\n    static deepClone(origin, target) {\r\n        for (let prop in origin) {\r\n            if (origin.hasOwnProperty(prop)) {\r\n                //判断是原始值还是引用值 并且不包含null(null其实是原始值，但是typeof返回是'object')\r\n                if (typeof origin[prop] === 'object' && Object.prototype.toString.call(origin[prop]) !== '[object Null]') {\r\n                    //判断原始值是对象还是数组\r\n                    target[prop] = Object.prototype.toString.call(origin[prop]) === '[object Array]' ? [] : {};\r\n                    Tool.deepClone(origin[prop], target[prop]);\r\n                } else {\r\n                    //string null undefined number\r\n                    target[prop] = origin[prop];\r\n                }\r\n            }\r\n        }\r\n        return target;\r\n    }\r\n}\r\n\r\n\r\nexport default Tool;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import './polyfill';\r\nimport UploadFile from './upload';\r\n\r\n\r\nmodule.exports = UploadFile;\r\n\r\n\r\n","/**\r\n * @description  解决IE不认识 Object.assign 的问题\r\n * @description2 采用自 https://developer.mozilla.org/zh-CN/\r\n * */\r\n\r\nif (typeof Object.assign != 'function') {\r\n    // Must be writable: true, enumerable: false, configurable: true\r\n    Object.defineProperty(Object, \"assign\", {\r\n        value: function assign(target, varArgs) { // .length of function is 2\r\n            'use strict';\r\n            if (target == null) { // TypeError if undefined or null\r\n                throw new TypeError('Cannot convert undefined or null to object');\r\n            }\r\n\r\n            var to = Object(target);\r\n\r\n            for (var index = 1; index < arguments.length; index++) {\r\n                var nextSource = arguments[index];\r\n\r\n                if (nextSource != null) { // Skip over if undefined or null\r\n                    for (var nextKey in nextSource) {\r\n                        // Avoid bugs when hasOwnProperty is shadowed\r\n                        if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\r\n                            to[nextKey] = nextSource[nextKey];\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return to;\r\n        },\r\n        writable: true,\r\n        configurable: true\r\n    });\r\n}\r\n","import Slice from './slice';\r\n\r\nimport Tool from './tool';\r\n\r\nimport Http from './http';\r\n\r\nimport getFileMd5 from './getMd5';\r\n\r\n\r\nclass UploadFile {\r\n\r\n    constructor(options) {\r\n\r\n        // 切片的大小数\r\n        this.chunkSile = options.chunkSile || 10;\r\n        // 请求地址\r\n        this.url = options.url || 'http://127.0.0.1';\r\n        // 请求数据\r\n        this.formData = {};\r\n        // 请求文件\r\n        this.formSleceFile = [];\r\n\r\n        // 请求头\r\n        this.headers = {};\r\n        // 回调\r\n        this.callBack = options.callBack || {};\r\n        // 一个切片连续上传几次失败直接断开整个文件上传\r\n        this.sliceTryFreq = options.sliceTryFreq || 10;\r\n        // 是否最后发送MD5值进行校验\r\n        this.isSendCheckMd5 = options.isSendCheckMd5 || false;\r\n\r\n        this.delay = options.delay || 0;\r\n    }\r\n\r\n    /**\r\n     * @description 追加请求头\r\n     * @param headers {Object} 请求头对象\r\n     * @return {Object} this\r\n     * */\r\n    appendHeader(headers) {\r\n        Object.assign(this.headers, headers);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * @description 追加请求携带数据\r\n     * @param datas {Object}\r\n     * @return object this\r\n     * */\r\n    appendData(datas) {\r\n        Object.assign(this.formData, datas);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * @description 追加请求文件数据\r\n     * @param files {Object}\r\n     * @return object this\r\n     * */\r\n    appendFile(files) {\r\n\r\n        // 将文件集合切片放入本对象fromFile\r\n        for (let key in files) {\r\n            let file = null;\r\n            if (!files[key]) {\r\n                throw new Error('No correct file was selected');\r\n            } else if (files[key].nodeType === 1) {\r\n                file = files[key]['files'][0];\r\n            } else if (typeof jQuery !== 'undefined' && files[key] instanceof jQuery) {\r\n                file = files[key][0]['files'][0];\r\n            } else if (files[key] instanceof FileList) {\r\n                file = files[key][0];\r\n            } else if (files[key] instanceof File) {\r\n                file = files[key];\r\n            }\r\n\r\n            // 实例化切片对象，将文件进行切片、计算等操作\r\n            let slice = new Slice({\r\n                chunkSile: this.chunkSile,\r\n                file: file\r\n            });\r\n\r\n\r\n            // 将文件所有切片存入切片集合\r\n            this.formSleceFile[key] = {\r\n                totalSize: file.size,\r\n                fileName: file['name'],\r\n                // fileKey: Tool.makeRandom() + '.' + Tool.getFileNameSuffix(files[key]['name']),\r\n                fileKey: Tool.makeRandom(),\r\n                slices: slice.getSlice(),\r\n                primordial: file\r\n            };\r\n\r\n        }\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    send() {\r\n\r\n        // #a001 上传的所有字段放在数组里面\r\n        let allField = Object.keys(this.formSleceFile);\r\n        // #b001 将进度回调的所有字段名称、回调格式定好\r\n        let progressCallObj = {\r\n            /* fieldName: {\r\n                 totalSize: 0,\r\n                 fileName: '',\r\n                 fileKey: '',\r\n                 chunkLength: 0\r\n             }\r\n             */\r\n        };\r\n\r\n        // #c001 将获取成功的MD5回到\r\n        let md5CallObj = {};\r\n\r\n        // #d001 将每次单文件上传完成的响应存起来\r\n        let allSuccessResult = [];\r\n        // 多文件\r\n        for (let key in this.formSleceFile) {\r\n            // 单个文件\r\n            let singleFile = this.formSleceFile[key],\r\n                // 单个文件总共已经上传的字节\r\n                singleLoadedTotal = 0,\r\n                // 临时记录本次与上次的相隔的大小\r\n                s = 0;\r\n            // 进度回调参数\r\n            progressCallObj[key] = {\r\n                totalSize: singleFile['totalSize'],\r\n                fileName: singleFile['fileName'],\r\n                fileKey: singleFile['fileKey'],\r\n                chunkLength: singleFile['slices'].length,\r\n                loadedTotalSize: 0\r\n            };\r\n            // 获取文件MD5\r\n            md5CallObj[key] = {\r\n                field: key,\r\n                fileKey: singleFile['fileKey'],\r\n                fileName: singleFile['fileName'],\r\n                md5: null\r\n            };\r\n            if (this.isSendCheckMd5) {\r\n                getFileMd5({\r\n                    file: singleFile['primordial'],\r\n                    success: (res) => {\r\n                        // console.log('md5md5md5md5');\r\n                        md5CallObj[key].md5 = res.md5;\r\n                        // 全部获取成功才进行回调\r\n                        let is = true;\r\n                        for (let key in md5CallObj) {\r\n                            if (!md5CallObj[key].md5) {\r\n                                is = false;\r\n                            }\r\n                        }\r\n                        if (is) {\r\n                            this.callBack.getFileMd5 &&\r\n                            this.callBack.getFileMd5(md5CallObj);\r\n                            // 发送md5校验\r\n\r\n                            let md5Header = [];\r\n                            for (let key in md5CallObj) {\r\n                                md5Header.push({\r\n                                    'upload-file-id': md5CallObj[key]['fileKey'],\r\n                                    md5: md5CallObj[key]['md5'],\r\n                                    suffix: Tool.getFileNameSuffix(md5CallObj[key]['fileName'])\r\n                                });\r\n                            }\r\n                            new Http({\r\n                                callBack: {\r\n                                    checkMd5Result: (resp) => {\r\n                                        this.callBack.checkMd5Result &&\r\n                                        this.callBack.checkMd5Result(resp);\r\n                                    }\r\n                                },\r\n                                sliceTryFreq: this.sliceTryFreq,\r\n                                url: this.url,\r\n                                isCheckMd5Request: true,\r\n                                headers: {\r\n                                    'upload-file-md5': JSON.stringify(md5Header)\r\n                                },\r\n                                formData: {\r\n                                    'upload-file-md5': JSON.stringify(md5Header)\r\n                                }\r\n\r\n                            }).send();\r\n                        }\r\n                    },\r\n                    progress(res) {\r\n                        // console.log(res);\r\n                    },\r\n                    complete(res) {\r\n                        // console.log(res);\r\n                    },\r\n                    error: function (res) {\r\n                        // console.log(res);\r\n                    }\r\n                });\r\n            }\r\n\r\n            // 多切片,循环将切片加入请求队列\r\n            for (let i = 0; i < singleFile['slices'].length; i++) {\r\n                // console.log(singleFile['slices'][i]);\r\n                // 与切片上传所需请求头合并\r\n                this.headers = Object.assign(this.headers, {\r\n                    // 该段起始位置-结束位置\r\n                    'upload-size-range': singleFile['slices'][i].start + '-' + singleFile['slices'][i].end,\r\n                    // 总大小\r\n                    'upload-total-size': singleFile.totalSize,\r\n                    // 总共所需上传次数\r\n                    'upload-total-slice': singleFile['slices'].length,\r\n                    // 当前是第几块\r\n                    'upload-now-order': i + 1,\r\n                    // 当前前端上传key\r\n                    'upload-file-id': singleFile['fileKey']\r\n                });\r\n\r\n                new Http({\r\n                    callBack: {\r\n                        // 每个切片实时上传回调\r\n                        progress: progress => {\r\n                            if (singleLoadedTotal === 0) {\r\n                                // 如果第一次为0，直接等于\r\n                                singleLoadedTotal = progress[key];\r\n                            } else {\r\n                                // e加等于本次实时减去上一次结束的\r\n                                singleLoadedTotal += progress[key] - s;\r\n                            }\r\n\r\n                            // #b002 将文件实时上传情况回调\r\n                            progressCallObj[key].loadedTotalSize = singleLoadedTotal;\r\n\r\n                            this.callBack.progress &&\r\n                            /*浏览器打印对象时如果对象未展开，由于对象引用问题，\r\n                            最后展开会导致显示不准确，所以采用深拷贝解决，更利于调试*/\r\n                            this.callBack.progress(Tool.deepClone(progressCallObj, {}));\r\n\r\n                            // 记录上一次结束的\r\n                            s = progress[key];\r\n                        },\r\n                        // 一个文件(全部切片)上传成功回调\r\n                        singleSuccess: resp => {\r\n                            try {\r\n                                this.callBack.singleSuccess &&\r\n                                this.callBack.singleSuccess({\r\n                                    field: resp.field,\r\n                                    response: typeof resp.response === 'string' ? JSON.parse(resp.response) : resp.response\r\n                                });\r\n\r\n                                // #d002\r\n                                allSuccessResult.push({\r\n                                    field: resp.field,\r\n                                    response: typeof resp.response === 'string' ? JSON.parse(resp.response) : resp.response\r\n                                });\r\n\r\n                                // #a002 判断是否全部上传完成\r\n                                for (let k = 0; k < allField.length; k++) {\r\n                                    if (key === allField[k]) {\r\n                                        // 上传一个移除\r\n                                        allField.splice(k, 1);\r\n                                        break;\r\n                                    }\r\n                                }\r\n                                if (allField.length === 0) {\r\n                                    // #a003\r\n                                    this.callBack.allSuccess &&\r\n                                    this.callBack.allSuccess(allSuccessResult);\r\n                                }\r\n                            } catch (e) {\r\n                                throw new Error(e.toString());\r\n\r\n                            }\r\n\r\n\r\n                        },\r\n                        // 一块切片上传成功回调\r\n                        sliceSuccess() {\r\n                            // 一块上传完成重置临时记录的大小\r\n                            s = 0;\r\n                        },\r\n                        error(resp) {\r\n                            console.log(resp);\r\n                        },\r\n                        // 某个文件由于某个切片上传连续失败回调\r\n                        tryFreqError: errorMsg => {\r\n\r\n                            this.callBack.tryFreqError &&\r\n                            this.callBack.tryFreqError(errorMsg);\r\n                        }\r\n                    },\r\n                    url: this.url,\r\n                    sliceTryFreq: this.sliceTryFreq,\r\n                    headers: this.headers,\r\n                    formData: this.formData,\r\n                    fileData: {\r\n                        fieldName: key,\r\n                        fileName: singleFile['fileName'],\r\n                        fileKey: singleFile['fileKey'],\r\n                        file: singleFile['slices'][i],\r\n                        order: i\r\n                        //\r\n                        // [key]: {\r\n                        //     fileName: singleFile['fileName'],\r\n                        //     fileKey: singleFile['fileKey'],\r\n                        //     file: singleFile['slices'][i]\r\n                        // }\r\n                    },\r\n                    delay: this.delay\r\n                }).send();\r\n            }\r\n\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\nexport default UploadFile;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass Slice {\r\n\r\n\r\n    constructor(options) {\r\n        // 文件\r\n        this.file = options.file;\r\n        // 文件大小\r\n        this.totalSize = this.file.size;\r\n        // 切片大小\r\n        this.chunkSile = options.chunkSile * 1024 * 1024;\r\n        // 需要传输几次\r\n        this.chunkLength = 0;\r\n        // 切片集合\r\n        this.slices = [];\r\n\r\n        // 切片开始位置\r\n        this.start = 0;\r\n        // 切片结束位置\r\n        this.end = 0;\r\n\r\n        this._compute();\r\n    }\r\n\r\n\r\n    /**\r\n     * @description 计算总共需要传输几次\r\n     * @return {Object} this\r\n     * */\r\n    _compute() {\r\n        // console.log('文件总大小' + this.totalSize);\r\n        if (this.totalSize <= this.chunkSile) {\r\n            this.chunkLength = 1;\r\n        } else {\r\n            this.chunkLength = Math.ceil(this.totalSize / this.chunkSile);\r\n        }\r\n        // console.log(this.chunkLength);\r\n    }\r\n\r\n    /**\r\n     * @description 获取该文件对象所以切片\r\n     * @return {Array} 切片集合\r\n     * */\r\n    getSlice() {\r\n        if (this.slices.length !== 0) {\r\n            return this.slices;\r\n        }\r\n        for (let i = 1; i <= this.chunkLength; i++) {\r\n            // 如果是总共传输一次或者最后一次\r\n            if (i === this.chunkLength || this.chunkLength === 1) {\r\n                this.end = this.totalSize;\r\n            } else {\r\n                this.end = i * this.chunkSile;\r\n            }\r\n            // 剪切文件\r\n            let blob = this.file.slice(this.start, this.end);\r\n\r\n            this.slices.push({\r\n                blob,\r\n                order: i,\r\n                start: this.start,\r\n                end: this.end\r\n            });\r\n            this.start = this.end;\r\n        }\r\n        return this.slices;\r\n    }\r\n\r\n\r\n    /**\r\n     * @description 获取当前文件对象的大小\r\n     * @return {Number}\r\n     * */\r\n    getSize() {\r\n        return this.totalSize;\r\n    }\r\n\r\n    /**\r\n     * @description 获取当前文件切片块数\r\n     * @return {Number}\r\n     * */\r\n    getChunkLength() {\r\n        return this.chunkLength;\r\n    }\r\n\r\n\r\n}\r\n\r\nexport default Slice;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","\r\n\r\nimport queueSend from './queue.send';\r\nimport Tool from './tool';\r\n\r\nclass Http {\r\n\r\n    constructor(options) {\r\n        this.url = options.url;\r\n        this.formData = Tool.deepClone(options.formData, {});\r\n        this.headers = Tool.deepClone(options.headers || {}, {});\r\n        this.fileData = options.fileData || {};\r\n        this.callBack = options.callBack || {};\r\n        this.sliceTryFreq = options.sliceTryFreq;\r\n        this.isCheckMd5Request = options.isCheckMd5Request || false;\r\n        this.delay = options.delay;\r\n    }\r\n\r\n\r\n    send() {\r\n        let nowUploadKey = null;\r\n        if (this.fileData.fieldName) {\r\n            // 当前发送的key\r\n            nowUploadKey = this.fileData.fieldName;\r\n        }\r\n\r\n\r\n        // 追加到队列\r\n        queueSend.queue.push({\r\n            delay: this.delay,\r\n            // 本次请求切片所属字段\r\n            fieldName: this.fileData.fieldName,\r\n            // 本次请求切片在文件的第几块\r\n            order: this.fileData.order || '',\r\n            trySend: 0,\r\n            // 最大限度每个切片允许上传失败次数\r\n            maxTrySend: this.sliceTryFreq,\r\n            isCheckMd5Request: this.isCheckMd5Request,\r\n            cancelSend: (isCheckMd5Request) => {\r\n                if (isCheckMd5Request) {\r\n                    this.callBack.checkMd5Result &&\r\n                    this.callBack.checkMd5Result({\r\n                        httpStatus: queueSend.lastHttpStatus,\r\n                        response: null\r\n                    });\r\n\r\n                } else {\r\n                    // 取消本文件的所以切片上传\r\n                    queueSend.removeField(this.fileData.fieldName);\r\n                    this.callBack.tryFreqError &&\r\n                    this.callBack.tryFreqError({\r\n                        httpStatus: queueSend.lastHttpStatus,\r\n                        fieldName: this.fileData.fieldName, // 字段名称\r\n                        order: this.fileData.order // 在第几块一直失败\r\n                    });\r\n                }\r\n\r\n            },\r\n\r\n            // 队列执行函数\r\n            fn: () => {\r\n                let formData = new FormData();\r\n                let xhr = new XMLHttpRequest();\r\n                //\r\n                let url = this.url;\r\n                if (/\\?/.test(url)) {\r\n                    url = url + '&upload-random=' + Tool.makeRandom();\r\n                } else {\r\n                    url = url + '?upload-random=' + Tool.makeRandom();\r\n                }\r\n                xhr.open('post', url, true);\r\n                // 循环追加数据\r\n                for (let key in this.formData) {\r\n                    formData.append(key, this.formData[key]);\r\n                }\r\n                // 循环追加请求头\r\n                for (let key in this.headers) {\r\n                    xhr.setRequestHeader(key, this.headers[key]);\r\n                }\r\n\r\n                if (nowUploadKey) {\r\n                    // 追加文件\r\n                    formData.append(this.fileData.fieldName/*file key*/,\r\n                        this.fileData['file']['blob']/*blob*/,\r\n                        this.fileData['fileName']/*file name*/);\r\n                }\r\n\r\n\r\n                // 监听状态改变\r\n                xhr.onreadystatechange = () => {\r\n\r\n                    if (xhr.readyState === 4 && xhr.status === 200) {\r\n                        // 返回200，表示一个文件请求成功，通知删除该请求队列\r\n                        queueSend.sendSuccess();\r\n                        this.callBack.singleSuccess && this.callBack.singleSuccess({\r\n                            field: this.fileData.fieldName,\r\n                            status: xhr.status,\r\n                            response: xhr.responseText\r\n                        });\r\n                        try {\r\n                            // 是否是校验md5请求\r\n                            if (this.isCheckMd5Request) {\r\n                                this.callBack.checkMd5Result &&\r\n                                this.callBack.checkMd5Result({\r\n                                    httpStatus: queueSend.lastHttpStatus,\r\n                                    response: typeof xhr.responseText === 'string' ? JSON.parse(xhr.responseText) : xhr.responseText\r\n                                });\r\n                            }\r\n                        } catch (e) {\r\n                            throw new Error(e.toString());\r\n                        }\r\n\r\n                    }\r\n\r\n                    if (xhr.readyState === 4 && xhr.status === 206) {\r\n                        // 返回206，表示一块切片请求成功，通知删除该请求队列\r\n                        queueSend.sendSuccess();\r\n                        this.callBack.sliceSuccess && this.callBack.sliceSuccess({\r\n                            status: xhr.status,\r\n                            response: xhr.responseText\r\n                        });\r\n                    }\r\n                    // 请求完成，继续下一次请求，如果后台报非200 || 206则没有通知上传成功，会继续发送上一次请求\r\n                    if (xhr.readyState === 4) {\r\n                        // 保存最后一次HTTP状态码\r\n                        queueSend.lastHttpStatus = xhr.status;\r\n                        queueSend.isSendLoading = false;\r\n                        queueSend.send();\r\n                    }\r\n\r\n                };\r\n                // 监听进度\r\n                xhr.upload.onprogress = (evt) => {\r\n                    if (evt.lengthComputable) {\r\n\r\n                        // this.callBack.progress && this.callBack.progress(Math.round(evt.loaded / evt.total * 100));\r\n                        this.callBack.progress\r\n                        && this.callBack.progress(\r\n                            {[nowUploadKey]: evt.loaded}\r\n                        );\r\n                    }\r\n                };\r\n                xhr.send(formData);\r\n            }\r\n        });\r\n        queueSend.send();\r\n    }\r\n}\r\n\r\n\r\nexport default Http;\r\n\r\n\r\n\r\n\r\n","\r\n\r\nexport default {\r\n    isSendLoading: false,\r\n    queue: [],\r\n    lastHttpStatus: 0,\r\n    send: function () {\r\n        if (!this.isSendLoading) {\r\n            if (this.queue.length > 0) {\r\n                this.isSendLoading = true;\r\n                setTimeout(() => {\r\n                    this.queue[0].trySend++;\r\n                    // 判断一块切片是否已经超过指定失败数\r\n                    if (this.queue[0].trySend <= this.queue[0].maxTrySend) {\r\n                        this.queue[0].fn();\r\n                    } else {\r\n                        console.log(this.queue[0].isCheckMd5Request);\r\n                        this.queue[0].cancelSend(this.queue[0].isCheckMd5Request/*取消类型，false文件 || true校验MD5*/);\r\n                    }\r\n\r\n                }, this.queue[0].delay);\r\n            }\r\n        }\r\n    },\r\n    // 是否发送成功，成功删除上一次队列的请求，否则继续重发\r\n    sendSuccess() {\r\n        this.queue.splice(0, 1);\r\n    },\r\n    // 移除指定字段的所有队列\r\n    removeField(fieldName) {\r\n        this.queue = this.queue.filter(item => {\r\n            return item.fieldName !== fieldName;\r\n        });\r\n        // 继续发送\r\n        this.isSendLoading = false;\r\n        this.send();\r\n    }\r\n};","/*\r\n * Fastest md5 implementation around (JKM md5).\r\n * Credits: Joseph Myers\r\n *\r\n * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\r\n * @see http://jsperf.com/md5-shootout/7\r\n */\r\n\r\n/* this function is much faster,\r\n  so if possible we use it. Some IEs\r\n  are the only ones I know of that\r\n  need the idiotic second function,\r\n  generated by an if clause.  */\r\nvar add32 = function (a, b) {\r\n        return (a + b) & 0xFFFFFFFF;\r\n    },\r\n    hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];\r\n\r\n\r\nfunction cmn(q, a, b, x, s, t) {\r\n    a = add32(add32(a, q), add32(x, t));\r\n    return add32((a << s) | (a >>> (32 - s)), b);\r\n}\r\n\r\nfunction md5cycle(x, k) {\r\n    var a = x[0],\r\n        b = x[1],\r\n        c = x[2],\r\n        d = x[3];\r\n\r\n    a += (b & c | ~b & d) + k[0] - 680876936 | 0;\r\n    a = (a << 7 | a >>> 25) + b | 0;\r\n    d += (a & b | ~a & c) + k[1] - 389564586 | 0;\r\n    d = (d << 12 | d >>> 20) + a | 0;\r\n    c += (d & a | ~d & b) + k[2] + 606105819 | 0;\r\n    c = (c << 17 | c >>> 15) + d | 0;\r\n    b += (c & d | ~c & a) + k[3] - 1044525330 | 0;\r\n    b = (b << 22 | b >>> 10) + c | 0;\r\n    a += (b & c | ~b & d) + k[4] - 176418897 | 0;\r\n    a = (a << 7 | a >>> 25) + b | 0;\r\n    d += (a & b | ~a & c) + k[5] + 1200080426 | 0;\r\n    d = (d << 12 | d >>> 20) + a | 0;\r\n    c += (d & a | ~d & b) + k[6] - 1473231341 | 0;\r\n    c = (c << 17 | c >>> 15) + d | 0;\r\n    b += (c & d | ~c & a) + k[7] - 45705983 | 0;\r\n    b = (b << 22 | b >>> 10) + c | 0;\r\n    a += (b & c | ~b & d) + k[8] + 1770035416 | 0;\r\n    a = (a << 7 | a >>> 25) + b | 0;\r\n    d += (a & b | ~a & c) + k[9] - 1958414417 | 0;\r\n    d = (d << 12 | d >>> 20) + a | 0;\r\n    c += (d & a | ~d & b) + k[10] - 42063 | 0;\r\n    c = (c << 17 | c >>> 15) + d | 0;\r\n    b += (c & d | ~c & a) + k[11] - 1990404162 | 0;\r\n    b = (b << 22 | b >>> 10) + c | 0;\r\n    a += (b & c | ~b & d) + k[12] + 1804603682 | 0;\r\n    a = (a << 7 | a >>> 25) + b | 0;\r\n    d += (a & b | ~a & c) + k[13] - 40341101 | 0;\r\n    d = (d << 12 | d >>> 20) + a | 0;\r\n    c += (d & a | ~d & b) + k[14] - 1502002290 | 0;\r\n    c = (c << 17 | c >>> 15) + d | 0;\r\n    b += (c & d | ~c & a) + k[15] + 1236535329 | 0;\r\n    b = (b << 22 | b >>> 10) + c | 0;\r\n\r\n    a += (b & d | c & ~d) + k[1] - 165796510 | 0;\r\n    a = (a << 5 | a >>> 27) + b | 0;\r\n    d += (a & c | b & ~c) + k[6] - 1069501632 | 0;\r\n    d = (d << 9 | d >>> 23) + a | 0;\r\n    c += (d & b | a & ~b) + k[11] + 643717713 | 0;\r\n    c = (c << 14 | c >>> 18) + d | 0;\r\n    b += (c & a | d & ~a) + k[0] - 373897302 | 0;\r\n    b = (b << 20 | b >>> 12) + c | 0;\r\n    a += (b & d | c & ~d) + k[5] - 701558691 | 0;\r\n    a = (a << 5 | a >>> 27) + b | 0;\r\n    d += (a & c | b & ~c) + k[10] + 38016083 | 0;\r\n    d = (d << 9 | d >>> 23) + a | 0;\r\n    c += (d & b | a & ~b) + k[15] - 660478335 | 0;\r\n    c = (c << 14 | c >>> 18) + d | 0;\r\n    b += (c & a | d & ~a) + k[4] - 405537848 | 0;\r\n    b = (b << 20 | b >>> 12) + c | 0;\r\n    a += (b & d | c & ~d) + k[9] + 568446438 | 0;\r\n    a = (a << 5 | a >>> 27) + b | 0;\r\n    d += (a & c | b & ~c) + k[14] - 1019803690 | 0;\r\n    d = (d << 9 | d >>> 23) + a | 0;\r\n    c += (d & b | a & ~b) + k[3] - 187363961 | 0;\r\n    c = (c << 14 | c >>> 18) + d | 0;\r\n    b += (c & a | d & ~a) + k[8] + 1163531501 | 0;\r\n    b = (b << 20 | b >>> 12) + c | 0;\r\n    a += (b & d | c & ~d) + k[13] - 1444681467 | 0;\r\n    a = (a << 5 | a >>> 27) + b | 0;\r\n    d += (a & c | b & ~c) + k[2] - 51403784 | 0;\r\n    d = (d << 9 | d >>> 23) + a | 0;\r\n    c += (d & b | a & ~b) + k[7] + 1735328473 | 0;\r\n    c = (c << 14 | c >>> 18) + d | 0;\r\n    b += (c & a | d & ~a) + k[12] - 1926607734 | 0;\r\n    b = (b << 20 | b >>> 12) + c | 0;\r\n\r\n    a += (b ^ c ^ d) + k[5] - 378558 | 0;\r\n    a = (a << 4 | a >>> 28) + b | 0;\r\n    d += (a ^ b ^ c) + k[8] - 2022574463 | 0;\r\n    d = (d << 11 | d >>> 21) + a | 0;\r\n    c += (d ^ a ^ b) + k[11] + 1839030562 | 0;\r\n    c = (c << 16 | c >>> 16) + d | 0;\r\n    b += (c ^ d ^ a) + k[14] - 35309556 | 0;\r\n    b = (b << 23 | b >>> 9) + c | 0;\r\n    a += (b ^ c ^ d) + k[1] - 1530992060 | 0;\r\n    a = (a << 4 | a >>> 28) + b | 0;\r\n    d += (a ^ b ^ c) + k[4] + 1272893353 | 0;\r\n    d = (d << 11 | d >>> 21) + a | 0;\r\n    c += (d ^ a ^ b) + k[7] - 155497632 | 0;\r\n    c = (c << 16 | c >>> 16) + d | 0;\r\n    b += (c ^ d ^ a) + k[10] - 1094730640 | 0;\r\n    b = (b << 23 | b >>> 9) + c | 0;\r\n    a += (b ^ c ^ d) + k[13] + 681279174 | 0;\r\n    a = (a << 4 | a >>> 28) + b | 0;\r\n    d += (a ^ b ^ c) + k[0] - 358537222 | 0;\r\n    d = (d << 11 | d >>> 21) + a | 0;\r\n    c += (d ^ a ^ b) + k[3] - 722521979 | 0;\r\n    c = (c << 16 | c >>> 16) + d | 0;\r\n    b += (c ^ d ^ a) + k[6] + 76029189 | 0;\r\n    b = (b << 23 | b >>> 9) + c | 0;\r\n    a += (b ^ c ^ d) + k[9] - 640364487 | 0;\r\n    a = (a << 4 | a >>> 28) + b | 0;\r\n    d += (a ^ b ^ c) + k[12] - 421815835 | 0;\r\n    d = (d << 11 | d >>> 21) + a | 0;\r\n    c += (d ^ a ^ b) + k[15] + 530742520 | 0;\r\n    c = (c << 16 | c >>> 16) + d | 0;\r\n    b += (c ^ d ^ a) + k[2] - 995338651 | 0;\r\n    b = (b << 23 | b >>> 9) + c | 0;\r\n\r\n    a += (c ^ (b | ~d)) + k[0] - 198630844 | 0;\r\n    a = (a << 6 | a >>> 26) + b | 0;\r\n    d += (b ^ (a | ~c)) + k[7] + 1126891415 | 0;\r\n    d = (d << 10 | d >>> 22) + a | 0;\r\n    c += (a ^ (d | ~b)) + k[14] - 1416354905 | 0;\r\n    c = (c << 15 | c >>> 17) + d | 0;\r\n    b += (d ^ (c | ~a)) + k[5] - 57434055 | 0;\r\n    b = (b << 21 | b >>> 11) + c | 0;\r\n    a += (c ^ (b | ~d)) + k[12] + 1700485571 | 0;\r\n    a = (a << 6 | a >>> 26) + b | 0;\r\n    d += (b ^ (a | ~c)) + k[3] - 1894986606 | 0;\r\n    d = (d << 10 | d >>> 22) + a | 0;\r\n    c += (a ^ (d | ~b)) + k[10] - 1051523 | 0;\r\n    c = (c << 15 | c >>> 17) + d | 0;\r\n    b += (d ^ (c | ~a)) + k[1] - 2054922799 | 0;\r\n    b = (b << 21 | b >>> 11) + c | 0;\r\n    a += (c ^ (b | ~d)) + k[8] + 1873313359 | 0;\r\n    a = (a << 6 | a >>> 26) + b | 0;\r\n    d += (b ^ (a | ~c)) + k[15] - 30611744 | 0;\r\n    d = (d << 10 | d >>> 22) + a | 0;\r\n    c += (a ^ (d | ~b)) + k[6] - 1560198380 | 0;\r\n    c = (c << 15 | c >>> 17) + d | 0;\r\n    b += (d ^ (c | ~a)) + k[13] + 1309151649 | 0;\r\n    b = (b << 21 | b >>> 11) + c | 0;\r\n    a += (c ^ (b | ~d)) + k[4] - 145523070 | 0;\r\n    a = (a << 6 | a >>> 26) + b | 0;\r\n    d += (b ^ (a | ~c)) + k[11] - 1120210379 | 0;\r\n    d = (d << 10 | d >>> 22) + a | 0;\r\n    c += (a ^ (d | ~b)) + k[2] + 718787259 | 0;\r\n    c = (c << 15 | c >>> 17) + d | 0;\r\n    b += (d ^ (c | ~a)) + k[9] - 343485551 | 0;\r\n    b = (b << 21 | b >>> 11) + c | 0;\r\n\r\n    x[0] = a + x[0] | 0;\r\n    x[1] = b + x[1] | 0;\r\n    x[2] = c + x[2] | 0;\r\n    x[3] = d + x[3] | 0;\r\n}\r\n\r\nfunction md5blk(s) {\r\n    var md5blks = [],\r\n        i;\r\n    /* Andy King said do it this way. */\r\n\r\n    for (i = 0; i < 64; i += 4) {\r\n        md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\r\n    }\r\n    return md5blks;\r\n}\r\n\r\nfunction md5blk_array(a) {\r\n    var md5blks = [],\r\n        i;\r\n    /* Andy King said do it this way. */\r\n\r\n    for (i = 0; i < 64; i += 4) {\r\n        md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\r\n    }\r\n    return md5blks;\r\n}\r\n\r\nfunction md51(s) {\r\n    var n = s.length,\r\n        state = [1732584193, -271733879, -1732584194, 271733878],\r\n        i,\r\n        length,\r\n        tail,\r\n        tmp,\r\n        lo,\r\n        hi;\r\n\r\n    for (i = 64; i <= n; i += 64) {\r\n        md5cycle(state, md5blk(s.substring(i - 64, i)));\r\n    }\r\n    s = s.substring(i - 64);\r\n    length = s.length;\r\n    tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\n    for (i = 0; i < length; i += 1) {\r\n        tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\r\n    }\r\n    tail[i >> 2] |= 0x80 << ((i % 4) << 3);\r\n    if (i > 55) {\r\n        md5cycle(state, tail);\r\n        for (i = 0; i < 16; i += 1) {\r\n            tail[i] = 0;\r\n        }\r\n    }\r\n\r\n    // Beware that the final length might not fit in 32 bits so we take care of that\r\n    tmp = n * 8;\r\n    tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\r\n    lo = parseInt(tmp[2], 16);\r\n    hi = parseInt(tmp[1], 16) || 0;\r\n\r\n    tail[14] = lo;\r\n    tail[15] = hi;\r\n\r\n    md5cycle(state, tail);\r\n    return state;\r\n}\r\n\r\nfunction md51_array(a) {\r\n    var n = a.length,\r\n        state = [1732584193, -271733879, -1732584194, 271733878],\r\n        i,\r\n        length,\r\n        tail,\r\n        tmp,\r\n        lo,\r\n        hi;\r\n\r\n    for (i = 64; i <= n; i += 64) {\r\n        md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\r\n    }\r\n\r\n    // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\r\n    // containing the last element of the parent array if the sub array specified starts\r\n    // beyond the length of the parent array - weird.\r\n    // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\r\n    a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\r\n\r\n    length = a.length;\r\n    tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\n    for (i = 0; i < length; i += 1) {\r\n        tail[i >> 2] |= a[i] << ((i % 4) << 3);\r\n    }\r\n\r\n    tail[i >> 2] |= 0x80 << ((i % 4) << 3);\r\n    if (i > 55) {\r\n        md5cycle(state, tail);\r\n        for (i = 0; i < 16; i += 1) {\r\n            tail[i] = 0;\r\n        }\r\n    }\r\n\r\n    // Beware that the final length might not fit in 32 bits so we take care of that\r\n    tmp = n * 8;\r\n    tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\r\n    lo = parseInt(tmp[2], 16);\r\n    hi = parseInt(tmp[1], 16) || 0;\r\n\r\n    tail[14] = lo;\r\n    tail[15] = hi;\r\n\r\n    md5cycle(state, tail);\r\n\r\n    return state;\r\n}\r\n\r\nfunction rhex(n) {\r\n    var s = '',\r\n        j;\r\n    for (j = 0; j < 4; j += 1) {\r\n        s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\r\n    }\r\n    return s;\r\n}\r\n\r\nfunction hex(x) {\r\n    var i;\r\n    for (i = 0; i < x.length; i += 1) {\r\n        x[i] = rhex(x[i]);\r\n    }\r\n    return x.join('');\r\n}\r\n\r\n// In some cases the fast add32 function cannot be used..\r\nif (hex(md51('hello')) !== '5d41402abc4b2a76b9719d911017c592') {\r\n    add32 = function (x, y) {\r\n        var lsw = (x & 0xFFFF) + (y & 0xFFFF),\r\n            msw = (x >> 16) + (y >> 16) + (lsw >> 16);\r\n        return (msw << 16) | (lsw & 0xFFFF);\r\n    };\r\n}\r\n\r\n// ---------------------------------------------------\r\n\r\n/**\r\n * ArrayBuffer slice polyfill.\r\n *\r\n * @see https://github.com/ttaubert/node-arraybuffer-slice\r\n */\r\n\r\nif (typeof ArrayBuffer !== 'undefined' && !ArrayBuffer.prototype.slice) {\r\n    (function () {\r\n        function clamp(val, length) {\r\n            val = (val | 0) || 0;\r\n\r\n            if (val < 0) {\r\n                return Math.max(val + length, 0);\r\n            }\r\n\r\n            return Math.min(val, length);\r\n        }\r\n\r\n        ArrayBuffer.prototype.slice = function (from, to) {\r\n            var length = this.byteLength,\r\n                begin = clamp(from, length),\r\n                end = length,\r\n                num,\r\n                target,\r\n                targetArray,\r\n                sourceArray;\r\n\r\n            if (to !== undefined) {\r\n                end = clamp(to, length);\r\n            }\r\n\r\n            if (begin > end) {\r\n                return new ArrayBuffer(0);\r\n            }\r\n\r\n            num = end - begin;\r\n            target = new ArrayBuffer(num);\r\n            targetArray = new Uint8Array(target);\r\n\r\n            sourceArray = new Uint8Array(this, begin, num);\r\n            targetArray.set(sourceArray);\r\n\r\n            return target;\r\n        };\r\n    })();\r\n}\r\n\r\n// ---------------------------------------------------\r\n\r\n/**\r\n * Helpers.\r\n */\r\n\r\nfunction toUtf8(str) {\r\n    if (/[\\u0080-\\uFFFF]/.test(str)) {\r\n        str = unescape(encodeURIComponent(str));\r\n    }\r\n\r\n    return str;\r\n}\r\n\r\nfunction utf8Str2ArrayBuffer(str, returnUInt8Array) {\r\n    var length = str.length,\r\n        buff = new ArrayBuffer(length),\r\n        arr = new Uint8Array(buff),\r\n        i;\r\n\r\n    for (i = 0; i < length; i += 1) {\r\n        arr[i] = str.charCodeAt(i);\r\n    }\r\n\r\n    return returnUInt8Array ? arr : buff;\r\n}\r\n\r\nfunction arrayBuffer2Utf8Str(buff) {\r\n    return String.fromCharCode.apply(null, new Uint8Array(buff));\r\n}\r\n\r\nfunction concatenateArrayBuffers(first, second, returnUInt8Array) {\r\n    var result = new Uint8Array(first.byteLength + second.byteLength);\r\n\r\n    result.set(new Uint8Array(first));\r\n    result.set(new Uint8Array(second), first.byteLength);\r\n\r\n    return returnUInt8Array ? result : result.buffer;\r\n}\r\n\r\nfunction hexToBinaryString(hex) {\r\n    var bytes = [],\r\n        length = hex.length,\r\n        x;\r\n\r\n    for (x = 0; x < length - 1; x += 2) {\r\n        bytes.push(parseInt(hex.substr(x, 2), 16));\r\n    }\r\n\r\n    return String.fromCharCode.apply(String, bytes);\r\n}\r\n\r\n// ---------------------------------------------------\r\n\r\n/**\r\n * SparkMD5 OOP implementation.\r\n *\r\n * Use this class to perform an incremental md5, otherwise use the\r\n * static methods instead.\r\n */\r\n\r\nfunction SparkMD5() {\r\n    // call reset to init the instance\r\n    this.reset();\r\n}\r\n\r\n/**\r\n * Appends a string.\r\n * A conversion will be applied if an utf8 string is detected.\r\n *\r\n * @param {String} str The string to be appended\r\n *\r\n * @return {SparkMD5} The instance itself\r\n */\r\nSparkMD5.prototype.append = function (str) {\r\n    // Converts the string to utf8 bytes if necessary\r\n    // Then append as binary\r\n    this.appendBinary(toUtf8(str));\r\n\r\n    return this;\r\n};\r\n\r\n/**\r\n * Appends a binary string.\r\n *\r\n * @param {String} contents The binary string to be appended\r\n *\r\n * @return {SparkMD5} The instance itself\r\n */\r\nSparkMD5.prototype.appendBinary = function (contents) {\r\n    this._buff += contents;\r\n    this._length += contents.length;\r\n\r\n    var length = this._buff.length,\r\n        i;\r\n\r\n    for (i = 64; i <= length; i += 64) {\r\n        md5cycle(this._hash, md5blk(this._buff.substring(i - 64, i)));\r\n    }\r\n\r\n    this._buff = this._buff.substring(i - 64);\r\n\r\n    return this;\r\n};\r\n\r\n/**\r\n * Finishes the incremental computation, reseting the internal state and\r\n * returning the result.\r\n *\r\n * @param {Boolean} raw True to get the raw string, false to get the hex string\r\n *\r\n * @return {String} The result\r\n */\r\nSparkMD5.prototype.end = function (raw) {\r\n    var buff = this._buff,\r\n        length = buff.length,\r\n        i,\r\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n        ret;\r\n\r\n    for (i = 0; i < length; i += 1) {\r\n        tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\r\n    }\r\n\r\n    this._finish(tail, length);\r\n    ret = hex(this._hash);\r\n\r\n    if (raw) {\r\n        ret = hexToBinaryString(ret);\r\n    }\r\n\r\n    this.reset();\r\n\r\n    return ret;\r\n};\r\n\r\n/**\r\n * Resets the internal state of the computation.\r\n *\r\n * @return {SparkMD5} The instance itself\r\n */\r\nSparkMD5.prototype.reset = function () {\r\n    this._buff = '';\r\n    this._length = 0;\r\n    this._hash = [1732584193, -271733879, -1732584194, 271733878];\r\n\r\n    return this;\r\n};\r\n\r\n/**\r\n * Gets the internal state of the computation.\r\n *\r\n * @return {Object} The state\r\n */\r\nSparkMD5.prototype.getState = function () {\r\n    return {\r\n        buff: this._buff,\r\n        length: this._length,\r\n        hash: this._hash\r\n    };\r\n};\r\n\r\n/**\r\n * Gets the internal state of the computation.\r\n *\r\n * @param {Object} state The state\r\n *\r\n * @return {SparkMD5} The instance itself\r\n */\r\nSparkMD5.prototype.setState = function (state) {\r\n    this._buff = state.buff;\r\n    this._length = state.length;\r\n    this._hash = state.hash;\r\n\r\n    return this;\r\n};\r\n\r\n/**\r\n * Releases memory used by the incremental buffer and other additional\r\n * resources. If you plan to use the instance again, use reset instead.\r\n */\r\nSparkMD5.prototype.destroy = function () {\r\n    delete this._hash;\r\n    delete this._buff;\r\n    delete this._length;\r\n};\r\n\r\n/**\r\n * Finish the final calculation based on the tail.\r\n *\r\n * @param {Array}  tail   The tail (will be modified)\r\n * @param {Number} length The length of the remaining buffer\r\n */\r\nSparkMD5.prototype._finish = function (tail, length) {\r\n    var i = length,\r\n        tmp,\r\n        lo,\r\n        hi;\r\n\r\n    tail[i >> 2] |= 0x80 << ((i % 4) << 3);\r\n    if (i > 55) {\r\n        md5cycle(this._hash, tail);\r\n        for (i = 0; i < 16; i += 1) {\r\n            tail[i] = 0;\r\n        }\r\n    }\r\n\r\n    // Do the final computation based on the tail and length\r\n    // Beware that the final length may not fit in 32 bits so we take care of that\r\n    tmp = this._length * 8;\r\n    tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\r\n    lo = parseInt(tmp[2], 16);\r\n    hi = parseInt(tmp[1], 16) || 0;\r\n\r\n    tail[14] = lo;\r\n    tail[15] = hi;\r\n    md5cycle(this._hash, tail);\r\n};\r\n\r\n/**\r\n * Performs the md5 hash on a string.\r\n * A conversion will be applied if utf8 string is detected.\r\n *\r\n * @param {String}  str The string\r\n * @param {Boolean} [raw] True to get the raw string, false to get the hex string\r\n *\r\n * @return {String} The result\r\n */\r\nSparkMD5.hash = function (str, raw) {\r\n    // Converts the string to utf8 bytes if necessary\r\n    // Then compute it using the binary function\r\n    return SparkMD5.hashBinary(toUtf8(str), raw);\r\n};\r\n\r\n/**\r\n * Performs the md5 hash on a binary string.\r\n *\r\n * @param {String}  content The binary string\r\n * @param {Boolean} [raw]     True to get the raw string, false to get the hex string\r\n *\r\n * @return {String} The result\r\n */\r\nSparkMD5.hashBinary = function (content, raw) {\r\n    var hash = md51(content),\r\n        ret = hex(hash);\r\n\r\n    return raw ? hexToBinaryString(ret) : ret;\r\n};\r\n\r\n// ---------------------------------------------------\r\n\r\n/**\r\n * SparkMD5 OOP implementation for array buffers.\r\n *\r\n * Use this class to perform an incremental md5 ONLY for array buffers.\r\n */\r\nSparkMD5.ArrayBuffer = function () {\r\n    // call reset to init the instance\r\n    this.reset();\r\n};\r\n\r\n/**\r\n * Appends an array buffer.\r\n *\r\n * @param {ArrayBuffer} arr The array to be appended\r\n *\r\n * @return {SparkMD5.ArrayBuffer} The instance itself\r\n */\r\nSparkMD5.ArrayBuffer.prototype.append = function (arr) {\r\n    var buff = concatenateArrayBuffers(this._buff.buffer, arr, true),\r\n        length = buff.length,\r\n        i;\r\n\r\n    this._length += arr.byteLength;\r\n\r\n    for (i = 64; i <= length; i += 64) {\r\n        md5cycle(this._hash, md5blk_array(buff.subarray(i - 64, i)));\r\n    }\r\n\r\n    this._buff = (i - 64) < length ? new Uint8Array(buff.buffer.slice(i - 64)) : new Uint8Array(0);\r\n\r\n    return this;\r\n};\r\n\r\n/**\r\n * Finishes the incremental computation, reseting the internal state and\r\n * returning the result.\r\n *\r\n * @param {Boolean} raw True to get the raw string, false to get the hex string\r\n *\r\n * @return {String} The result\r\n */\r\nSparkMD5.ArrayBuffer.prototype.end = function (raw) {\r\n    var buff = this._buff,\r\n        length = buff.length,\r\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n        i,\r\n        ret;\r\n\r\n    for (i = 0; i < length; i += 1) {\r\n        tail[i >> 2] |= buff[i] << ((i % 4) << 3);\r\n    }\r\n\r\n    this._finish(tail, length);\r\n    ret = hex(this._hash);\r\n\r\n    if (raw) {\r\n        ret = hexToBinaryString(ret);\r\n    }\r\n\r\n    this.reset();\r\n\r\n    return ret;\r\n};\r\n\r\n/**\r\n * Resets the internal state of the computation.\r\n *\r\n * @return {SparkMD5.ArrayBuffer} The instance itself\r\n */\r\nSparkMD5.ArrayBuffer.prototype.reset = function () {\r\n    this._buff = new Uint8Array(0);\r\n    this._length = 0;\r\n    this._hash = [1732584193, -271733879, -1732584194, 271733878];\r\n\r\n    return this;\r\n};\r\n\r\n/**\r\n * Gets the internal state of the computation.\r\n *\r\n * @return {Object} The state\r\n */\r\nSparkMD5.ArrayBuffer.prototype.getState = function () {\r\n    var state = SparkMD5.prototype.getState.call(this);\r\n\r\n    // Convert buffer to a string\r\n    state.buff = arrayBuffer2Utf8Str(state.buff);\r\n\r\n    return state;\r\n};\r\n\r\n/**\r\n * Gets the internal state of the computation.\r\n *\r\n * @param {Object} state The state\r\n *\r\n * @return {SparkMD5.ArrayBuffer} The instance itself\r\n */\r\nSparkMD5.ArrayBuffer.prototype.setState = function (state) {\r\n    // Convert string to buffer\r\n    state.buff = utf8Str2ArrayBuffer(state.buff, true);\r\n\r\n    return SparkMD5.prototype.setState.call(this, state);\r\n};\r\n\r\nSparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\r\n\r\nSparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\r\n\r\n/**\r\n * Performs the md5 hash on an array buffer.\r\n *\r\n * @param {ArrayBuffer} arr The array buffer\r\n * @param {Boolean}     [raw] True to get the raw string, false to get the hex one\r\n *\r\n * @return {String} The result\r\n */\r\nSparkMD5.ArrayBuffer.hash = function (arr, raw) {\r\n    var hash = md51_array(new Uint8Array(arr)),\r\n        ret = hex(hash);\r\n\r\n    return raw ? hexToBinaryString(ret) : ret;\r\n};\r\n\r\n\r\n/**\r\n * @description 重新包装该方法\r\n * */\r\nfunction getFileMd5(options) {\r\n    var file = options.file;\r\n    var md5Str;\r\n    var blobSlice = File.prototype.slice || File.prototype.mozSlice || File.prototype.webkitSlice,\r\n        // file = this.files[0],\r\n        chunkSize = 8097152, // Read in chunks of 2MB\r\n        chunks = Math.ceil(file.size / chunkSize),\r\n        currentChunk = 0,\r\n        spark = new SparkMD5.ArrayBuffer(),\r\n        fileReader = new FileReader();\r\n\r\n    fileReader.onload = function (e) {\r\n        // console.log('read chunk nr', currentChunk + 1, 'of', chunks);\r\n        spark.append(e.target.result); // Append array buffer\r\n        currentChunk++;\r\n        var md5_progress = Math.floor((currentChunk / chunks) * 100);\r\n        options.progress && options.progress({\r\n            fileName: file.name,\r\n            progress: md5_progress\r\n        });\r\n        if (currentChunk < chunks) {\r\n            loadNext();\r\n        } else {\r\n            md5Str = spark.end();\r\n            options.success && options.success({\r\n                md5: md5Str,\r\n                msg: 'success'\r\n            });\r\n            options.complete && options.complete({\r\n                result: true\r\n            });\r\n            // console.log(md5Str);\r\n        }\r\n    };\r\n\r\n    fileReader.onerror = function () {\r\n        options.error && options.error({\r\n            md5: '',\r\n            msg: 'error'\r\n        });\r\n        options.complete && options.complete({\r\n            result: false\r\n        });\r\n    };\r\n\r\n    function loadNext() {\r\n        var start = currentChunk * chunkSize,\r\n            end = ((start + chunkSize) >= file.size) ? file.size : start + chunkSize;\r\n        fileReader.readAsArrayBuffer(blobSlice.call(file, start, end));\r\n    }\r\n\r\n    loadNext();\r\n}\r\n\r\nexport default getFileMd5;"],"sourceRoot":""}